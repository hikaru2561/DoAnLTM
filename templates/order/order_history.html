<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Test Lịch sử Lệnh</title>
    <style>
      :root {
        --bg-dark: #1c1e2c;
        --table-bg: #2a2d3e;
        --header-bg: #35384a;
        --text-light: #e6e6e6;
        --highlight: #ffcc00;
        --border-color: #444;
        --primary: #ff4d4f;
      }

      body {
        background-color: var(--bg-dark);
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-light);
      }

      .wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* thêm dòng này để căn giữa theo chiều dọc trong wrapper */
        text-align: center;
        max-width: 960px;
        width: 100%;
        padding: 20px;
      }

      h2 {
        font-size: 24px;
        margin-bottom: 12px; /* thêm khoảng cách với nút */
        color: #fff;
      }

      button {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 10px 20px;
        font-weight: 600;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 16px;
        transition: background-color 0.3s ease;
      }

      button:hover {
        background-color: #d9363e;
      }

      #message {
        margin-bottom: 10px;
        font-size: 15px;
        color: #ccc;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        background-color: var(--table-bg);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        margin-top: 16px;
      }

      th,
      td {
        border-bottom: 1px solid var(--border-color);
        padding: 12px 16px;
        text-align: center;
        font-size: 15px;
      }

      th {
        background-color: var(--header-bg);
        color: var(--highlight);
        font-weight: 600;
      }

      td {
        color: var(--text-light);
      }

      tr:last-child td {
        border-bottom: none;
      }
    </style>
  </head>
  <body>
    <body>
      {% include 'components/back_button.html' %}
      <div class="wrapper">
        <h2>Lịch sử lệnh</h2>
        <div id="message" class="message"></div>
        <table id="orderTable" style="display: none">
          <thead>
            <tr>
              <th>Mã CK</th>
              <th>Số lượng</th>
              <th>Giá</th>
              <th>Loại lệnh</th>
              <th>Trạng thái</th>
              <th>Thời điểm</th>
            </tr>
          </thead>
          <tbody id="orderBody"></tbody>
        </table>
      </div>
    </body>

    <script>
      async function loadOrderHistory() {
        const messageDiv = document.getElementById("message");
        const table = document.getElementById("orderTable");
        const tbody = document.getElementById("orderBody");

        messageDiv.textContent = "";
        table.style.display = "none";
        tbody.innerHTML = "";

        try {
          const response = await fetch("/order/history", {
            method: "GET",
            credentials: "include", // để gửi cookie nếu đăng nhập bằng session
          });

          if (response.status === 401) {
            messageDiv.textContent =
              "⚠️ Bạn chưa đăng nhập. Vui lòng đăng nhập để xem lịch sử lệnh.";
            return;
          }

          const data = await response.json();

          if (data.orders && data.orders.length > 0) {
            data.orders.forEach((order) => {
              const row = document.createElement("tr");
              row.innerHTML = `
              <td>${order.symbol_id}</td>
              <td>${order.so_luong}</td>
              <td>${order.gia}</td>
              <td>${order.loai_lenh}</td>
              <td>${order.trang_thai}</td>
              <td>${order.thoi_diem}</td>
            `;
              tbody.appendChild(row);
            });
            table.style.display = "table";
          } else {
            messageDiv.textContent = "Không có lệnh nào.";
          }
        } catch (error) {
          messageDiv.textContent = "❌ Lỗi khi tải dữ liệu: " + error;
        }
      }

      window.onload = loadOrderHistory();
    </script>
  </body>
</html>
