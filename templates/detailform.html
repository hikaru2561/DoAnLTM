<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Detail Form</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/detailformstock.css') }}">

</head>

<body>
    <form id="stockDetailForm" aria-label="Stock Detail Form">
        <div class="stock-detail-header">
            <h2>Chi ti·∫øt c·ªï phi·∫øu <span id="modalSymbol"></span></h2>
        </div>
        <div class="stock-detail-overview">
            <div class="stock-detail-quote">
                <h3>
                    <span id="stock-detail-form-price">23.00</span>
                    <span id="stock-detail-form-variation">0.00%</span>
                </h3>
                <p>
                    M·ªü C·ª≠a/Trung b√¨nh: <span id="stock-detail-form-open-range">23.00/22.91</span><br>
                    Th·∫•p/Cao: <span id="stock-detail-form-range">22.80/23.05</span><br>
                    T·ªïng KL: <span id="stock-detail-form-volume-total">7,316,600</span>
                </p>
            </div>
            <div class="stock-detail-metrics">
                <p>
                    Tr·∫ßn: <span id="stock-detail-form-ceiling" style="color: #F23AFF;">24.60</span><br>
                    S√†n: <span id="stock-detail-form-floor" style="color: #00C9AF;">21.40</span><br>
                    Tham chi·∫øu: <span id="stock-detail-form-reference" style="color: #FDFF12;">23.00</span>
                </p>
            </div>
            <div class="stock-detail-bidask">
                <h4>ƒê·ªô s√¢u th·ªã tr∆∞·ªùng</h4>
                <table>
                    <thead>
                        <tr>
                            <th>KL</th>
                            <th>Gi√° b√°n</th>
                            <th>KL</th>
                            <th>Gi√° mua</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="stock-detail-form-buy-vol-1"></td>
                            <td id="stock-detail-form-buy-price-1"></td>
                            <td id="stock-detail-form-sell-vol-1"></td>
                            <td id="stock-detail-form-sell-price-1"></td>
                        </tr>
                        <tr>
                            <td id="stock-detail-form-buy-vol-2"></td>
                            <td id="stock-detail-form-buy-price-2"></td>
                            <td id="stock-detail-form-sell-vol-2"></td>
                            <td id="stock-detail-form-sell-price-2"></td>
                        </tr>
                        <tr>
                            <td id="stock-detail-form-buy-vol-3"></td>
                            <td id="stock-detail-form-buy-price-3"></td>
                            <td id="stock-detail-form-sell-vol-3"></td>
                            <td id="stock-detail-form-sell-price-3"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="stock-detail-main">
            <div class="stock-detail-chart">
                <iframe id="stockIframe" title="SSI TradingView Chart" aria-label="Stock TradingView Chart"></iframe>
            </div>

            <div class="stock-detail-trades">
                <div class="stock-info">
                    <div class="stock-name">
                        <span class="symbol">SSI</span>
                        <span class="exchange">(HOSE)</span>
                    </div>
                    <div class="price-info">
                        <div class="high">36.35</div>
                        <div class="current-price">34.00 <span class="change">(0.80 2.41%)</span></div>
                        <div class="low">31.65</div>
                    </div>
                    <div class="session-info">‚Ä¢ Phi√™n tr∆∞·ªõc gi·ªù<br>T·ªïng KL 56,726,000</div>
                </div>

                <div class="input-section">
                    <label>T√†i kho·∫£n ƒë·∫∑t l·ªánh</label>
                    <select>
                        <option>Ch·ªçn t√†i kho·∫£n</option>
                    </select>

                    <label>S·ª©c mua <span class="tooltip">‚ìò</span></label>
                    <div class="disabled-input">0 VND (0/0)</div>

                    <label>Gi√° t·ª± ƒë·ªông</label>
                    <label class="switch">
                        <input type="checkbox">
                        <span class="slider round"></span>
                    </label>

                    <label>Kh·ªëi l∆∞·ª£ng</label>
                    <div class="qty-control">
                        <button>-</button>
                        <input type="text" value="">
                        <button>+</button>
                    </div>

                    <label>Gi√° (x1000 VND)</label>
                    <div class="qty-control">
                        <button>-</button>
                        <input type="text" value="">
                        <button>+</button>
                    </div>
                </div>
                <div>
                    <label>Gi√° tr·ªã</label>
                    <div><span id=""></span> VND</div>
                </div>
                <div class="action-buttons">
                    <button class="buy">Mua</button>
                    <button class="sell">B√°n</button>
                </div>
            </div>
        </div>
    </form>
    <script>
        // ƒê·∫∑t ngo√†i onload ƒë·ªÉ lu√¥n nh·∫≠n ƒë∆∞·ª£c postMessage d√π iframe v·ª´a load hay ch∆∞a
        window.addEventListener('message', function (event) {
            const data = event.data;
            if (!data || data.type !== 'update_stock_detail') return;

            const item = data.payload;
            console.log("Received data:", item); // üëâ ki·ªÉm tra tr√™n console

            // G√°n v√†o iframe TradingView b√™n trong
            const tvIframe = document.getElementById('stockIframe');
            tvIframe.src = `https://iboard.ssi.com.vn/tradingview/?symbol=${item.Symbol}&language=vi&interval=D&theme=classic&target=tradingViewStockDetail&autoSave=1&forceTVChart=1&showVolume=1&timescaleMarks=1&sameDomain=1`;

            // C·∫≠p nh·∫≠t n·ªôi dung
            document.getElementById('modalSymbol').innerText = item.Symbol;

            // Gi√° mua
            document.getElementById('stock-detail-form-buy-vol-1').innerText = item.BidVol1.toLocaleString();
            document.getElementById('stock-detail-form-buy-price-1').innerText = (item.BidPrice1 / 1000).toFixed(2);
            document.getElementById('stock-detail-form-buy-vol-2').innerText = item.BidVol2.toLocaleString();
            document.getElementById('stock-detail-form-buy-price-2').innerText = (item.BidPrice2 / 1000).toFixed(2);
            document.getElementById('stock-detail-form-buy-vol-3').innerText = item.BidVol3.toLocaleString();
            document.getElementById('stock-detail-form-buy-price-3').innerText = (item.BidPrice3 / 1000).toFixed(2);

            // Gi√° b√°n
            document.getElementById('stock-detail-form-sell-vol-1').innerText = item.AskVol1.toLocaleString();
            document.getElementById('stock-detail-form-sell-price-1').innerText = (item.AskPrice1 / 1000).toFixed(2);
            document.getElementById('stock-detail-form-sell-vol-2').innerText = item.AskVol2.toLocaleString();
            document.getElementById('stock-detail-form-sell-price-2').innerText = (item.AskPrice2 / 1000).toFixed(2);
            document.getElementById('stock-detail-form-sell-vol-3').innerText = item.AskVol3.toLocaleString();
            document.getElementById('stock-detail-form-sell-price-3').innerText = (item.AskPrice3 / 1000).toFixed(2);

            // Tr·∫ßn - S√†n - Tham chi·∫øu
            document.getElementById('stock-detail-form-ceiling').innerText = (item.Ceiling / 1000).toFixed(2);
            document.getElementById('stock-detail-form-floor').innerText = (item.Floor / 1000).toFixed(2);
            document.getElementById('stock-detail-form-reference').innerText = (item.RefPrice / 1000).toFixed(2);
        });
    </script>
</body>

</html>